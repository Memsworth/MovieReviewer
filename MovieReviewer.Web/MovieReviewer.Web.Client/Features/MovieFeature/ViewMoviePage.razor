@page "/movie/{id:int}"
@inject HttpClient Http
@using MovieReviewer.Shared.Core.DTO.Outputs


<MudContainer MaxWidth="MaxWidth.Medium" Class="mt-4">
    <MudText Typo="Typo.h4" Align="Align.Center" Class="mb-4">Movie Details</MudText>

    @if (_movie is not null)
    {
        <ReviewWriter/>
        <MovieDetails Movie="_movie"/>
        <ReviewsList Reviews="_reviews"/>
    }
    else
    {
        <MudText Typo="Typo.body1" Align="Align.Center" Class="mt-4">Loading movie details...</MudText>
    }
</MudContainer>

@code {
    [Parameter] public int Id { get; set; }
    private MovieViewDTO? _movie;
    private List<ReviewViewDTO>? _reviews;

    /* TODO: Ask other blaozr devs if it is possbile  to call onInit to get movieList & then use onParaSet to change movieObject*/
    protected override async Task OnInitializedAsync()
    {
        var movieResponse = await Http.GetAsync($"/Movie/{Id}");
        var reviewResponse = await Http.GetAsync($"/Review/GetAll/{Id}");
        if (movieResponse.IsSuccessStatusCode)
        {
            _movie = await movieResponse.Content.ReadFromJsonAsync<MovieViewDTO>();
            if (reviewResponse.IsSuccessStatusCode)
                _reviews = await reviewResponse.Content.ReadFromJsonAsync<List<ReviewViewDTO>>();
        }
    }
}